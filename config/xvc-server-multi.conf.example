# XVC Server Multi-Instance Configuration
# This file is generated by xvc-discover
# Edit this file to customize settings before starting the server
#
# Workflow:
#   1. Run: sudo xvc-discover --output /etc/xvc-server/xvc-server-multi.conf
#   2. Edit: sudo nano /etc/xvc-server/xvc-server-multi.conf
#   3. Start: sudo xvc-server /etc/xvc-server/xvc-server-multi.conf
#
# Or use systemd:
#   sudo systemctl start xvc-server

[instance_management]
# Enable multi-instance mode (true/false)
enabled = true

# Base port for instances (each instance gets port + instance_number)
base_port = 2542

# Maximum number of instances
max_instances = 32

# Instance ID range (for port calculation)
instance_id_start = 1
instance_id_end = 32

[instance_mappings]
# Map instance IDs to specific devices
# Format: instance_id = device_id
# device_id can be: SN:serial, BUS:bus-dev, CUSTOM:name, or auto
#
# Examples:
#   1 = SN:ABC12345     - Use USB serial number (recommended, persistent)
#   2 = BUS:001-002     - Use USB bus/device location
#   3 = CUSTOM:PROD01   - Use custom device ID
#   4 = auto            - Auto-detect device on startup

# Example 1: Instance 1 handles HS2 with serial ABC12345
1 = SN:ABC12345

# Example 2: Instance 2 handles HS2 on bus 001 device 002
2 = BUS:001-002

# Example 3: Instance 3 handles custom device PROD01
3 = CUSTOM:PROD01

# Example 4: Instance 4 auto-detects device
4 = auto

# Example 5: Instance 5 auto-detects device
5 = auto

# Example: Assign specific device to instance ID
# 10 = SN:DEF67890

[instance_settings]
# Per-instance settings (optional)
#
# Format: instance_id:setting=value
#
# Available settings:
#   frequency         - JTAG TCK frequency in Hz (default: 30000000)
#   latency_timer     - FTDI latency timer in ms (default: 2, range: 1-255)
#   async             - Enable async I/O (default: true)
#   interface         - FTDI interface (default: 0)
#   xvc_buffer_size   - XVC max vector size in bytes (default: 2048, min: 64, max: 512MB)

# Example: Set specific TCK frequency for instance 1
1:frequency = 30000000

# Example: Set specific latency timer for instance 2
2:latency_timer = 2

# Example: Disable async for instance 3
3:async = false

# Example: Set interface index for instance 1
1:interface = 0

# Example: Set large XVC buffer for high-throughput JTAG (up to 512MB)
1:xvc_buffer_size = 65536
2:xvc_buffer_size = 262144

[instance_aliases]
# Human-readable aliases for instances

1 = Production Board A
2 = Production Board B
3 = Development Board
4 = Test Board A
5 = Test Board B

[network_per_instance]
# Per-instance network settings

# TCP options per instance
tcp_nodelay = true
tcp_keepalive = true
keepalive_idle = 30
keepalive_cnt = 5

# Connection timeout per instance (seconds)
connection_timeout = 300

[ip_whitelist_per_instance]
# Per-instance IP whitelist (optional)
#
# Format: instance_id:mode = mode_name
# Modes:
#   strict     - Only allowlisted IPs can connect
#   permissive - Allowlisted allowed, others logged but not blocked
#   off        - All IPs allowed (not recommended for production)
#
# Allowlist format: instance_id:allow_N = IP/CIDR
# Blocklist format: instance_id:block_N = IP/CIDR

# Example: Instance 1 uses strict whitelist
1:mode = strict

# Example: Instance 2 uses permissive whitelist
2:mode = permissive

# Example: Instance 3 allows all IPs
3:mode = off

# Allowlist per instance (format: instance_id:allow_N = IP/CIDR)
1:allow_1 = 192.168.1.0/24
1:allow_2 = 10.0.0.0/8

# Blocklist per instance (format: instance_id:block_N = IP/CIDR)
1:block_1 = 192.168.1.250
2:block_1 = 0.0.0.0/8

[logging_per_instance]
# Per-instance logging (optional)
#
# Format: instance_id:setting=value
#
# Levels: error, warn, info, debug

# Example: Different log levels per instance
1:level = info
2:level = debug
3:level = warn

# Example: Separate log files per instance
1:file = /var/log/xvc-server-instance-1.log
2:file = /var/log/xvc-server-instance-2.log

# If not specified, use pattern: /var/log/xvc-server-instance-{id}.log

[performance_per_instance]
# Per-instance performance settings
#
# Format: instance_id:setting=value

# Example: Different XVC buffer sizes per instance (up to 512MB supported)
1:xvc_buffer_size = 4096
2:xvc_buffer_size = 65536
3:xvc_buffer_size = 262144

# Example: Different latency timers per instance
1:ftdi_latency_timer = 4
2:ftdi_latency_timer = 2

[health_monitoring]
# Enable per-instance health monitoring
enabled = true

# Health check interval (seconds)
check_interval = 60

# Auto-restart failed instances
auto_restart = true

# Restart delay (seconds)
restart_delay = 5

# Max restart attempts before giving up
max_restart_attempts = 3

[instance_groups]
# Group instances for management

production = 1,2,3
development = 4,5
testing = 6,7,8

[auto_scaling]
# Enable automatic instance scaling based on load
enabled = false

# Minimum idle instances to keep running
min_idle_instances = 2

# Maximum active instances
max_active_instances = 16

# Scale down threshold (seconds)
scale_down_threshold = 300

# Scale up threshold (connections per instance)
scale_up_threshold = 4
